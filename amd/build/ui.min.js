define("tiny_eunitylink/ui",["exports","core/str","./common"],(function(_exports,_str,_common){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=async function(editor){const[title,linktextLabel,accessionLabel,createLabel]=await Promise.all([(0,_str.get_string)("dialogtitle",_common.component),(0,_str.get_string)("linktext",_common.component),(0,_str.get_string)("accessionnumber",_common.component),(0,_str.get_string)("createlink",_common.component)]),selectedText=editor.selection?editor.selection.getContent({format:"text"}):"",dialogHtml='\n        <form id="eunitylink-form" class="tiny-eunitylink-form">\n            <div class="form-group">\n                <label>'.concat(linktextLabel,'</label>\n                <input type="text" name="linktext" class="form-control" value="').concat(selectedText,'" required />\n            </div>\n            <div class="form-group">\n                <label>').concat(accessionLabel,'</label>\n                <input type="text" name="accessionnumber" class="form-control" required />\n            </div>\n        </form>\n    ');editor.windowManager.open({title:title,body:{type:"panel",items:[{type:"htmlpanel",html:dialogHtml}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:createLabel,primary:!0}],initialData:{},onSubmit:async api=>{const form=document.querySelector("#eunitylink-form"),linktext=form.linktext.value.trim(),accessionnumber=form.accessionnumber.value.trim();if(linktext&&accessionnumber)try{const response=await fetch(M.cfg.wwwroot+"/local/linkproxy/rest.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_dbvals",accessionnumber:accessionnumber,contextid:M.cfg.contextid})}),data=await response.json();data&&data.result&&data.result.url?(editor.insertContent('<a href="'.concat(data.result.url,'" target="_blank">').concat(linktext,"</a>")),api.close()):window.alert("Failed to create link.")}catch(e){window.alert("Error contacting backend.")}}})}}));

//# sourceMappingURL=ui.min.js.map